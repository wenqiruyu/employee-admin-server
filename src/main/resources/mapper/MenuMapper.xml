<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.employee.admin.mapper.IMenuMapper">
    <resultMap id="menuResultMap" type="com.employee.admin.vo.MenuVO">
        <result column="icon" jdbcType="BIGINT" property="icon"/>
        <result column="index" jdbcType="VARCHAR" property="index"/>
        <result column="title" jdbcType="VARCHAR" property="title"/>

        <collection property="subMenu" resultMap="menuSubResultMap" />
    </resultMap>

    <resultMap id="menuSubResultMap" type="com.employee.admin.vo.MenuSubVO">
        <result column="subIcon" jdbcType="BIGINT" property="subIcon"/>
        <result column="subIndex" jdbcType="VARCHAR" property="subIndex"/>
        <result column="subTitle" jdbcType="VARCHAR" property="subTitle"/>
    </resultMap>

    <select id="getAllMenu" resultMap="menuResultMap"><![CDATA[
        select par.icon,par.index,par.title,sub.icon,sub.index,sub.title
        from (
            select *
            from employee_menu_t
            where delete_flag = 0
            and is_sub = 0) par
        left join (
            select *
            from employee_menu_t
            where delete_flag = 0
            and is_sub = 1) sub
        on par.id = sub.parent_id
    ]]></select>

    <select id="getMenuByUser" resultMap="menuResultMap" parameterType="com.employee.admin.vo.QueryUserVO">
        select par.icon,par.index,par.title,sub.icon as subIcon,sub.index as subIndex,sub.title as subTitle
        from (
            select *
            from employee_menu_t
            where delete_flag = 0
            and is_sub = 1) sub,(
            select *
            from employee_menu_t
            where delete_flag = 0
            and is_sub = 0) par,(
            select role_id
            from employee_staff_role_t
            <where>
                delete_flag = 0
                <if test="userId != null and userId != ''">
                    and user_id = #{userId}
                </if>
            </where>
            ) role
        where par.id = sub.parent_id
        and sub.role <![CDATA[ >= ]]> role.role_id
        and par.role <![CDATA[ >= ]]> role.role_id

    </select>
</mapper>